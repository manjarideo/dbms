CREATE TABLE PUBLISHER(
NAME VARCHAR2 (20) PRIMARY KEY, 
PHONE INTEGER,
ADDRESS VARCHAR2 (20));

CREATE TABLE BOOK( 
BOOK_ID INTEGER PRIMARY KEY, 
TITLE VARCHAR2 (20), 
PUB_YEAR VARCHAR2 (20),
PUBLISHER_NAME REFERENCES PUBLISHER (NAME) ON DELETE CASCADE);


CREATE TABLE BOOK_AUTHORS 
(AUTHOR_NAME VARCHAR2 (20),
BOOK_ID REFERENCES BOOK (BOOK_ID) ON DELETE CASCADE, 
PRIMARY KEY (BOOK_ID, AUTHOR_NAME));


CREATE TABLE LIBRARY_PROGRAM(
PROG_ID INTEGER PRIMARY KEY, 
PROG_NAME VARCHAR2 (50), 
ADDRESS VARCHAR2 (50));


CREATE TABLE BOOK_COPIES 
(NO_OF_COPIES INTEGER,
BOOK_ID REFERENCES BOOK (BOOK_ID) ON DELETE CASCADE,
PROG_ID REFERENCES LIBRARY_PROGRAM(PROG_ID) ON DELETE CASCADE,
PRIMARY KEY (BOOK_ID, PROG_ID ));


CREATE TABLE BOOK_LENDING 
(DATE_OUT DATE,
DUE_DATE DATE,
BOOK_ID REFERENCES BOOK (BOOK_ID) ON DELETE CASCADE,
PROG_ID REFERENCES LIBRARY_PROGRAM (PROG_ID) ON DELETE CASCADE,
CARD_NO NUMBER(4), 
PRIMARY KEY (BOOK_ID, PROG_ID));



INSERT INTO PUBLISHER VALUES
('MCGRAW-HILL', 9989076587, 'BANGALORE');
INSERT INTO PUBLISHER VALUES
('PEARSON', 9889076565, 'NEWDELHI');
INSERT INTO PUBLISHER VALUES
('RANDOM HOUSE', 7455679345,'HYDRABAD');
INSERT INTO PUBLISHER VALUES
('HACHETTE LIVRE', 8970862340, 'CHENNAI');
INSERT INTO PUBLISHER VALUES
('GRUPO PLANETA', 7756120238, 'BANGALORE');

INSERT INTO BOOK VALUES
(1, 'DBMS', 'JAN-2017', 'MCGRAW-HILL');
INSERT INTO BOOK VALUES (2, 'ADBMS', 'JUN-2016', 'MCGRAW-HILL');
INSERT INTO BOOK VALUES
(3, 'CN', 'SEP-2016', 'PEARSON');
INSERT INTO BOOK VALUES
(4, 'CG', 'SEP-2015', 'GRUPO PLANETA');
INSERT INTO BOOK VALUES
(5, 'OS', 'MAY-2016', 'PEARSON');
SELECT * FROM BOOK;
INSERT INTO BOOK_AUTHORS VALUES
('NAVATHE', 1);
INSERT INTO BOOK_AUTHORS VALUES
('NAVATHE', 2);
INSERT INTO BOOK_AUTHORS VALUES
('TANENBAUM', 3);
INSERT INTO BOOK_AUTHORS VALUES
('EDWARD ANGEL', 4);
INSERT INTO BOOK_AUTHORS VALUES
('GALVIN', 5);

INSERT INTO LIBRARY_PROGRAM VALUES
(10, 'RR NAGAR', 'BANGALORE');
INSERT INTO LIBRARY_PROGRAM VALUES
(11, 'RNSIT', 'BANGALORE');
INSERT INTO LIBRARY_PROGRAM VALUES
(12, 'RAJAJI NAGAR', 'BANGALORE');
INSERT INTO LIBRARY_PROGRAM VALUES
(13, 'NITTE', 'MANGALORE');
INSERT INTO LIBRARY_PROGRAM VALUES
(14, 'MANIPAL', 'UDUPI');

INSERT INTO BOOK_COPIES VALUES
(10, 1, 10);
INSERT INTO BOOK_COPIES VALUES 
(5, 1, 11);
INSERT INTO BOOK_COPIES VALUES 
(2, 2, 12);
INSERT INTO BOOK_COPIES VALUES 
(5, 2, 13);
INSERT INTO BOOK_COPIES VALUES 
(7, 3, 14);
INSERT INTO BOOK_COPIES VALUES 
(1, 5, 10);
INSERT INTO BOOK_COPIES VALUES 
(3, 4, 11);

INSERT INTO BOOK_LENDING VALUES
('01-JAN-17', '01-JUN-17', 1, 10, 101);
INSERT INTO BOOK_LENDING VALUES
('11-JAN-17', '11-MAR-17', 3, 14, 101);
INSERT INTO BOOK_LENDING VALUES
('21-FEB-17', '21-APR-17', 2, 13, 101);
INSERT INTO BOOK_LENDING VALUES 
('15-MAR-17', '15-JUL-17', 4, 11, 101);
INSERT INTO BOOK_LENDING VALUES 
('12-APR-17', '12-MAY-17', 1, 11, 104);

--1
SELECT B.BOOK_ID, B.TITLE, B.PUBLISHER_NAME, A.AUTHOR_NAME,C.NO_OF_COPIES, L.PROG_ID
FROM BOOK B, BOOK_AUTHORS A, BOOK_COPIES C, LIBRARY_PROGRAM L
WHERE B.BOOK_ID=A.BOOK_ID 
AND B.BOOK_ID=C.BOOK_ID
AND L.PROG_ID=C.PROG_ID;

--2
SELECT CARD_NO FROM 
BOOK_LENDING
WHERE DATE_OUT BETWEEN '01-JAN-2017' AND '01-JUL-2017'
GROUP BY CARD_NO 
HAVING COUNT (*)>3;

--3
DELETE FROM BOOK 
WHERE BOOK_ID=1;
SELECT * FROM BOOK;

--4
SELECT PUB_YEAR FROM BOOK;
--OR
CREATE VIEW BOOKK_VIEW
AS 
SELECT PUB_YEAR FROM BOOK;

--5

CREATE VIEW BOOK_ISSUE AS
SELECT COUNT(*) AS BOOK_ISSUED, BOOK_ID, PROG_ID
FROM BOOK_LENDING
GROUP BY BOOK_ID, PROG_ID;

CREATE VIEW BOOK_AVL AS 
SELECT BC.BOOK_ID, BC.PROG_ID, (BC.NO_OF_COPIES - BI.BOOK_ISSUED) AS AVBL_BOOKS
FROM BOOK_COPIES BC
JOIN LIBRARY_PROGRAM LP ON BC.PROG_ID = LP.PROG_ID
LEFT JOIN BOOK_ISSUE BI ON BC.BOOK_ID = BI.BOOK_ID AND BC.PROG_ID = BI.PROG_ID;

SELECT * FROM BOOK_AVL NATURAL JOIN LIBRARY_PROGRAM;
